---
applyTo: "**/*.py"
---

# FastAPIベストプラクティス

## プロジェクト構造

- ディレクトリ構造を論理的に整理
- モジュールをドメインごとに組織化
- 依存性注入パターンを実装
- ルートをドメインごとに分離
- 必要なミドルウェアを実装
- 設定を環境変数で管理

## API設計

- HTTPメソッドの意味に従って利用
- ステータスコードを正しく返却
- リクエスト/レスポンスモデルを定義
- 入力値のバリデーションを実装
- エラーハンドリングを統一
- OpenAPIでドキュメント自動生成

## モデル

- Pydanticモデルでデータ構造を定義
- バリデーションルールを実装
- 型ヒントで型安全性を確保
- ドメインごとにモデルを整理
- 継承で共通属性を管理
- シリアライゼーション方法を制御

## データベース

- SQLAlchemyでORMを実装
- マイグレーション管理を導入
- コネクションプーリングでパフォーマンス向上
- トランザクション管理を適切に実装
- クエリを最適化
- データベースエラーを適切に処理

## 認証

- JWT認証を実装
- パスワードハッシュ化（bcrypt等）
- ロールベースアクセス制御
- セッション管理
- OAuth2実装
- 認証エラーを適切に処理

## セキュリティ

- CORSを実装
- レート制限を設定
- 入力検証を実装
- セキュリティヘッダーを設定
- セキュリティエラーを適切に処理
- ログ出力を実装

## パフォーマンス

- キャッシュを活用
- 非同期操作を実装
- バックグラウンドタスクを活用
- コネクションプーリングを実装
- クエリ最適化を実施
- パフォーマンスメトリクスを監視

## テスト

- 単体テストを作成
- 統合テストを実装
- テストフィクスチャを活用
- モッキングを実装
- エラーシナリオをテスト
- テストカバレッジを確保

## デプロイメント

- Docker設定を活用
- CI/CDを実装
- 環境変数を管理
- ログ出力を実装
- 監視システムを導入
- デプロイメントエラーを適切に処理

## ドキュメント

- docstringを適切に記述
- APIドキュメントを作成
- 型ヒントを追加
- ドキュメントを最新状態に維持
- エラーシナリオを文書化
- バージョニングを管理
