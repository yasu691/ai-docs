---
applyTo: "**/*.py"
---

# Pythonベストプラクティス

## プロジェクト構成

- `src/your_package_name/`形式のsrc-layoutを使用する
- `src/`と並列に`tests/`ディレクトリにテストを配置する
- 設定は`config/`ディレクトリまたは環境変数で管理する
- 依存関係は`requirements.txt`または`pyproject.toml`に記載する
- 静的ファイルは`static/`ディレクトリに配置する
- Jinja2テンプレートは`templates/`ディレクトリを使用する

## コードスタイル

- ruff formatコードフォーマッターに従う
- import文の並び替えにはisortを使用する
- PEP 8の命名規則に従う：
  - 関数と変数にはsnake_case
  - クラスにはPascalCase
  - 定数にはUPPER_CASE
- 最大行長は88文字（Blackのデフォルト）
- 相対インポートより絶対インポートを使用する

## 型ヒント

- すべての関数パラメータと戻り値に型ヒントを使用する
- `typing`モジュールから型をインポートする
- `Optional[Type]`ではなく`Type | None`を使用する
- ジェネリック型には`TypeVar`を使用する
- カスタム型は`types.py`で定義する
- ダックタイピングには`Protocol`を使用する

## Flask構成

- Flaskファクトリーパターンを使用する
- Blueprintを使用してルートを整理する
- データベースにはFlask-SQLAlchemyを使用する
- 適切なエラーハンドラーを実装する
- 認証にはFlask-Loginを使用する
- 適切な関心の分離でビューを構成する

## データベース

- SQLAlchemy ORMを使用する
- Alembicでデータベースマイグレーションを実装する
- 適切なコネクションプーリングを使用する
- モデルを別モジュールで定義する
- 適切なリレーションシップを実装する
- 適切なインデックス戦略を使用する

## 認証

- セッション管理にはFlask-Loginを使用する
- Flask-OAuthを使用してGoogle OAuthを実装する
- bcryptでパスワードをハッシュ化する
- 適切なセッションセキュリティを使用する
- CSRF保護を実装する
- 適切なロールベースアクセス制御を使用する

## API設計

- REST APIにはFlask-RESTfulを使用する
- 適切なリクエスト検証を実装する
- 適切なHTTPステータスコードを使用する
- エラーを一貫して処理する
- 適切なレスポンス形式を使用する
- 適切なレート制限を実装する

## テスト

- テストにはpytestを使用する
- すべてのルートのテストを書く
- カバレッジにはpytest-covを使用する
- 適切なフィクスチャーを実装する
- pytest-mockで適切なモックを使用する
- すべてのエラーシナリオをテストする

## セキュリティ

- 本番環境ではHTTPSを使用する
- 適切なCORSを実装する
- すべてのユーザー入力をサニタイズする
- 適切なセッション設定を使用する
- 適切なログ記録を実装する
- OWASPガイドラインに従う

## パフォーマンス

- Flask-Cachingで適切なキャッシングを使用する
- データベースクエリの最適化を実装する
- 適切なコネクションプーリングを使用する
- 適切なページネーションを実装する
- 重い処理にはバックグラウンドタスクを使用する
- アプリケーションパフォーマンスを監視する

## エラーハンドリング

- カスタム例外クラスを作成する
- 適切なtry-exceptブロックを使用する
- 適切なログ記録を実装する
- 適切なエラーレスポンスを返す
- エッジケースを適切に処理する
- 適切なエラーメッセージを使用する

## ドキュメント

- Googleスタイルのdocstringを使用する
- すべてのパブリックAPIを文書化する
- README.mdを最新状態に保つ
- 適切なインラインコメントを使用する
- APIドキュメントを生成する
- 環境セットアップを文書化する

## 開発ワークフロー

- パッケージとプロジェクト管理にはuvを使用する
- pre-commitフックを実装する
- 適切なGitワークフローを使用する
- セマンティックバージョニングに従う
- 適切なCI/CDプラクティスを使用する
- 適切なログ記録を実装する

## 依存関係

- 依存関係のバージョンを固定する
- 本番環境にはrequirements.txtを使用する
- 開発依存関係を分離する
- 適切なパッケージバージョンを使用する
- 依存関係を定期的に更新する
- セキュリティ脆弱性をチェックする
