---
mode: 'agent'
description: 'エージェントにリファクタリングを依頼するプロンプトです。'
---

# コードリファクタリング指示

以下の方針と手法をもとに、可読性、保守性、拡張性を向上させるためのリファクタリングを実施してください。

## リファクタリング方針

- コードの動作（外部仕様）は変更しないこと
- 既存のテストがあれば必ず全てパスすること
- 冗長な記述や重複コードを削除・共通化すること
- メソッドや変数の適切な命名を行うこと
- 関数/メソッドを適切な大きさ・責務に分割すること
- コメントやドキュメントを充実させること
- 適切な定数化を行うこと
- 設定値をハードコードせず、設定ファイルや環境変数から読み込むこと

## 主なリファクタリング手法

- メソッドの抽出（Extract Method）
- 変数の抽出（Extract Variable）
- 変数名・メソッド名の変更（Rename Variable/Method）
- 一時変数のインライン化（Inline Temp）
- 条件文の単純化（Decompose Conditional）
- ループの置き換え（Replace Loop with Pipeline）
- データのカプセル化（Encapsulate Field）
- クラスの分割（Extract Class）
- 重複コードの統合（Consolidate Duplicate Conditional Fragments）

## 具体的な改善例（必ず検討すること）

- ユーザー入力のバリデーションを追加し、想定外の入力に対処する
- 例外処理を整理し、すべての例外を適切にキャッチしてログ出力する
- デバッグ用のログ（トレース・レベル含む）を追加し、トラブルシューティングを容易にする
- 主要処理にコメントを追加し、処理の意図や前提条件が分かるようにする
- 命名規則を統一し、変数名・関数名は英語ベースでわかりやすく変更する
- 長すぎる関数を小さな単位に分割し、各関数の責務を明確にする
- 外部API呼び出しにはリトライ処理を導入し、一時的な障害に耐性を持たせる
- タイムアウト設定を追加し、外部リソースからの応答停止時にハングしないようにする
- エラーメッセージをユーザー視点で分かりやすく表現し、必要なら多言語対応を検討する
- クラス設計を見直し、単一責任の原則（SRP）に沿ってリファクタリングする
- ネストが深いロジックを平坦化し、早期リターンやガード節を活用する
- 複雑な条件分岐は述語関数に切り出すなどしてわかりやすく整理する
- 例外発生時でもリソースリークが起きないように、try-with-resourcesやfinallyで解放処理を追加
- 不要な計算や重いI/Oを削減し、パフォーマンスを改善する
- メモリリークを防止するため、使用後のオブジェクトや接続を確実に解放する
- スレッドセーフを考慮し、共有データアクセスには適切なロック機構や同期処理を導入
- 適用可能なデザインパターン（例：ファクトリー、ストラテジー、オブザーバーなど）を導入する
- 並列処理または非同期処理（スレッドプール、async/awaitなど）を活用してスループットを向上
- 重複しているコードを関数化して共通化し、DRY（Don't Repeat Yourself）を徹底
- 使われていないコードやコメントを削除し、コードベースをクリーンアップする
